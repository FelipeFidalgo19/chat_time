<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/cadastro.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
    <title>Cadastro</title>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src="./js/cadastro.js"></script>

   
    <div class="container">

        <form action="" method="post" class="form" name="cadastro1">
            <div class="logo">
                <img src="./img/logo.png" alt="logo" />
            </div>

            <input type="text" placeholder="Usuário" name="username" class="username" />
            <input type="email" placeholder="E-mail" name="email" class="email" />
            <input type="password" placeholder="Senha" name="password" class="password" />
            <input type="password" placeholder="Confirme sua senha" name="confirmPassword" class="confirmPassword" />
            <button type="submit" onclick="postRegister()">Criar usuário</button>

            <span>
                <p>Você já tem uma conta? <a href="./index.html">Logue aqui</a></p>
            </span>
            <h3 class="text">
                <p class="p"></p>
            </h3>
        </form>

    </div>
    <script type="text/javascript">

        function postRegister() {
            var name = document.querySelector(".username").value;
            var email = document.querySelector(".email").value;
            var confirmaSenha = document.querySelector(".confirmPassword").value;
            var senha = document.querySelector(".password").value;

            const localhost = 'http://localhost:5000/cadastro.html';
            const web = 'https://chatapsunip.herokuapp.com/cadastro.html';

            const timeShowmessage = () => {
                if (showMessage == true) {
                    axios.post(localhost, {
                        name: name,
                        email: email,
                        senha: senha
                    })
                        .then(function (response) {
                            window.location.href = './index.html';
                        })
                        .catch(function (error) {
                            exibeMensagem('Erro ao cadastrar');
                        })
                        .then(function () {
                            // always executed
                        });
                } else {
                    let timeout;
                    showMessage();
                    timeout = setTimeout(clearMessage, 3000);

                }
            }
            const showMessage = () => {
                let message;
                if (senha !== confirmaSenha) {
                    message = "Senha e confirmação de senha deve ser as mesmas";
                    p.innerHTML = message;
                    text.appendChild(p);
                    return false;

                } else if (name.length < 3) {
                    message = "Usuário deve ser maior do que 3 caracteres";
                    p.innerHTML = message;
                    text.appendChild(p);
                    return false;

                } else if (senha.length < 8) {
                    message = "Senha deve ser igual ou maior do que 8 caracteres";
                    p.innerHTML = message;
                    text.appendChild(p);
                    return false;

                } else if (email.value === "") {
                    message = "Email é requerido";
                    p.innerHTML = message;
                    text.appendChild(p);
                    return false;
                } else {
                    return true;
                }
            }

        }
    </script>
</body>

</html>